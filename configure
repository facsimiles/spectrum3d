#!/bin/bash
#'configure' script of spectrum3d

# Create a 'config.h' file

> src/config.h

echo "/* This file was automatically generated by the 'configure' script */

#ifndef DEFINE_DEFINES
#define DEFINE_DEFINES
">> src/config.h

echo " "

if [[ "$*" =~ "--enable-jack" ]]
    then
	echo "JACK support.....................YES"
	echo "#define JACK " >> src/config.h
	jack="jack"
else
	echo "JACK support.....................NO"
fi

if [[ "$*" =~ "--enable-realtime" ]]
    then
	echo "REAL TIME support (for ALSA).....YES"
	echo "#define REALTIME " >> src/config.h
else
	echo "REAL TIME support (for ALSA).....NO"
fi

if  [[ "$*" =~ "--enable-geis" ]]
    then
	echo "MULTITOUCH support...............YES"
	echo "#define GEIS " >> src/config.h
	geis="-lutouch-geis"
else
	echo "MULTITOUCH support...............NO"
fi

if [[ "$*" =~ "--enable-realtime" ]]
    then
	echo "
********** IMPORTANT WARNING **********  
If you enable RealTime support, you should :
1) add the following to the '/etc/security/limits.d/audio.conf' file : 
	@audio   -  rtprio     95
	@audio   -  memlock    unlimited
2) add yourself as a member of the 'audio' group; then reboot.
If you do not do this, you will have to run Spectrum3d as root."
fi

echo " "

echo "
#endif " >> src/config.h

###################################################################################################

# Create a Makefile

> Makefile

echo "# Spectrum3d 'Makefile' automatically generated by the 'configure' script

VPATH = src:../headers

objects = main.o mainwindow.o onclick.o menu.o display.o events.o geis.o scale.o testrtpool.o

spectrum3d : \$(objects)

	gcc  -Wall \$(objects) -o spectrum3d \`pkg-config $jack gstreamer-0.10 gtk+-2.0 --libs --cflags\` -lSDL -lSDL_ttf -lGL -lGLU $geis

main.o : main.c main.h config.h
	cc -c \$< \`pkg-config gtk+-2.0 --libs --cflags\` 

mainwindow.o : mainwindow.c mainwindow.h config.h
	cc -c \$< \`pkg-config gstreamer-0.10 gtk+-2.0 --libs --cflags\`

onclick.o : onclick.c onclick.h config.h
	cc -c \$< \`pkg-config gstreamer-0.10 gtk+-2.0 --libs --cflags\` 

menu.o : menu.c menu.h config.h
	cc -c \$< \`pkg-config gtk+-2.0 --libs --cflags\`

display.o : display.c display.h config.h
	cc -c \$< \`pkg-config gstreamer-0.10 --libs --cflags\` -lGL -lGLU 

events.o : events.c events.h config.h
	cc -c \$< \`pkg-config gtk+-2.0 --libs --cflags\` -lSDL 

geis.o : geis.c geis.h config.h
	cc -c \$< \`pkg-config gtk+-2.0 --libs --cflags\` $geis

scale.o : scale.c scale.h config.h
	cc -c \$< -lSDL -lSDL_ttf -lGL -lGLU

testrtpool.o : testrtpool.c testrtpool.h config.h
	cc -c \$< \`pkg-config gstreamer-0.10 --libs --cflags\`

.PHONY : clean
clean :
	-rm spectrum3d \$(objects)

prefix=/usr/local
    
install: spectrum3d
	install -m 0755 spectrum3d \$(prefix)/bin
	install -m 0777 files/spectrum3d.conf \$(prefix)/etc
	-mkdir \$(prefix)/share/icons
	install -m 0644 files/spectrum3d.png \$(prefix)/share/icons/spectrum3d.png
	install -m 0777 files/spectrum3d.desktop /usr/share/applications
	install -m 0644 files/FreeSans.ttf \$(prefix)/share/fonts

.PHONY: install

.PHONY : uninstall
uninstall :
	-rm \$(prefix)/bin/spectrum3d \$(prefix)/etc/spectrum3d.conf \$(prefix)/share/icons/spectrum3d.png /usr/share/applications/spectrum3d.desktop \$(prefix)/share/fonts/FreeSans.ttf" >> Makefile



